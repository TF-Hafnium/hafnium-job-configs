- scm:
    name: hafnium
    scm:
        - git:
            url: https://review.trustedfirmware.org/${GERRIT_PROJECT}
            refspec: ${GERRIT_REFSPEC}
            name: origin
            branches:
                - ${GERRIT_BRANCH}
            basedir: hafnium
            skip-tag: true
            shallow-clone: true
            wipe-workspace: true
            submodule:
                disable: false
                recursive: true
                tracking: false
                parent-credentials: true
                timeout: 15

- job:
    name: hafnium-build-test-review
    project-type: freestyle
    defaults: global
    properties:
      - build-discarder:
          days-to-keep: 90
          nums-to-keep: 90
    disabled: false
    node: docker-amd64-xenial
    display-name: 'Hafnium builder'
    triggers:
      - gerrit:
          server-name: 'review.trustedfirmware.org'
          trigger-on:
            - patchset-created-event
          projects:
            - project-compare-type: 'PLAIN'
              project-pattern: 'hafnium/hafnium'
              branches:
                - branch-pattern: 'master'
    scm:
        - hafnium
    wrappers:
      - timestamps
    builders:
      - shell: |
          #!/bin/bash

          set -xe

          cd ${WORKSPACE}/hafnium

          kokoro/build.sh
